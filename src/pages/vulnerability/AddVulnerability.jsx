import "./styles/AddVulnerability.css";
import Button from '@mui/material/Button';
import Select from '@mui/joy/Select';
import Option from '@mui/joy/Option';
import { useState } from "react";
import { useNavigate } from "react-router-dom";
import axios from "axios";

function AddVulnerability() {
    const [responseMsg, setResponseMsg] = useState("");
    const [vulnerability, setVulnerability] = useState({
        Vulnerability: "",
        Severity: "",
        Description: "",
        Remediation: "",
        References: "",
        CreatedBy: "",
        CreatedByUser: ""
    });

    const user = JSON.parse(localStorage.getItem("user"));

    const navigate = useNavigate();

    const handleSubmit = async (e) => {
        e.preventDefault();

        try {
            const response = await axios.post(`${process.env.REACT_APP_BACKEND_URL}/v1/createVulnerability`, { ...vulnerability, CreatedBy: user._id, CreatedByUser: user.username }, { headers: { 'x-access-token': `${user.accessToken}` } });
            setResponseMsg(response.data.message);
            navigate("/")
        } catch (error) {
            console.log(error);
        }
    }

    return (
        <form onSubmit={handleSubmit}>
            <div className="">
                <table>
                    <tbody>
                        <tr>
                            <th>Vulnerability</th>
                            <td>
                                <textarea
                                    name=""
                                    id=""
                                    cols="120"
                                    rows="2"
                                    required
                                    onChange={
                                        (e) => setVulnerability({ ...vulnerability, Vulnerability: e.target.value })
                                    }>
                                </textarea>
                            </td>
                        </tr>
                        <tr>
                            <th>Severity</th>
                            <td>
                                <Select
                                    placeholder="Select"
                                    variant="solid"
                                    color="primary"
                                    size="sm"
                                    required
                                    name=""
                                    onChange={
                                        (e, newValue) => setVulnerability({ ...vulnerability, Severity: newValue })
                                    }
                                    id="">
                                    <Option value="Critical">Critical</Option>
                                    <Option value="High">High</Option>
                                    <Option value="Medium">Medium</Option>
                                    <Option value="Low">Low</Option>
                                    <Option value="Informational">Informational</Option>
                                </Select>
                            </td>
                        </tr>
                        <tr>
                            <th>Description</th>
                            <td>
                                <textarea
                                    required
                                    name=""
                                    id=""
                                    cols="120"
                                    rows="6"
                                    onChange={(e) => setVulnerability({ ...vulnerability, Description: e.target.value })}></textarea></td>
                        </tr>
                        <tr>
                            <th>Remediation</th>
                            <td>
                                <textarea required name="" id="" cols="120" rows="6"
                                    onChange={
                                        (e) => setVulnerability({ ...vulnerability, Remediation: e.target.value })
                                    }>
                                </textarea>
                            </td>
                        </tr>
                        <tr>
                            <th>References</th>
                            <td>
                                <textarea required name="" id="" cols="120" rows="6" onChange={
                                    (e) => setVulnerability({ ...vulnerability, References: e.target.value })
                                }>
                                </textarea>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <Button variant="contained" required size="small" style={{ margin: "1rem 0" }} type={"submit"}>CREATE</Button>
                <p>{responseMsg}</p>
            </div>
        </form>
    )

}

export default AddVulnerability;
